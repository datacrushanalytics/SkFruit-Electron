<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title></title>
  <link rel="stylesheet" href="../../assets/css/sale3.css">

</head>

<body>
  <div class="container">
    <h1 align="center">विक्री </h1>
    <hr>
<form id="login">
    <div class="first-row">
      <input type="text" id="bill" name="number" placeholder="बिल नं.">
      <input type="text" id="date" name="date" placeholder="दिनांक:">
      <input type="text" id="number" name="number" placeholder="मोबाइल नं.">
    </div>

    <div>
      <label for="message" aria-placeholder="Root"></label>
      <select type="root" id="grahk" name="root" onchange="previousbalance()">
      </select>
      <label for="message" aria-placeholder="Root"></label>
      <select type="root" id="Route" name="root">
      </select>
      <br>
    </div>

    <div class="third-row">
      <input type="text" id="address" name="text" placeholder="पत्ता">
      <input type="text" id="sandarbh" name="text" placeholder="संदर्भ ">
    </div>


    <div>
      <label for="message" aria-placeholder="Root"></label>
      <select type="root" id="bta" name="root" onchange="getProducts()">
      </select>
      <label for="message" aria-placeholder="Root"></label>
      <select type="root" id="product" name="root">
      </select>
    </div>
    <!-- <div>
      <input type="text" id="product" name="text" placeholder="प्रॉडक्ट">
      <input type="text" id="bta" name="text" placeholder="बटा">
    </div> -->
    <input type="text" id="mark" name="text" placeholder="मार्क">
    <input type="number" id="kimmat" name="number" placeholder="किंमत">
    <input type="text" id="nag" name="text" placeholder="नग" onchange="updateTotal()">
    <input type="number" id="total" name="number" placeholder="एकूण रक्कम">


    <div class="fourth-row">
      <!-- <button class="border-hover" >Save</button> -->
      <button type="button" onclick="myFunction()" class="border-hover">ADD</button>
    </div>
    <table>
      <tr>
        <th></th>
        <th>प्रॉडक्ट</th>
        <th>बटा</th>
        <th>मार्क</th>
        <th>नग</th>
        <th>किंमत</th>
        <th>रक्कम</th>
      </tr>

      <!-- Add more rows as needed -->
      <tbody id="tableBody1">
        <!-- Data will be inserted here -->
      </tbody>
    </table>

    <div>
      <!-- <input type="number" id="no1" name="number" placeholder="गेलेले कॅरेट"> -->
      &nbsp;  &nbsp; &nbsp; गेलेले कॅरेट
      <input type="number" id="carate100" name="number" placeholder="100" onchange="carate()">
      <input type="number" id="carate150" name="number" placeholder="150" onchange="carate()">
      <input type="number" id="carate250" name="number" placeholder="250" onchange="carate()">
      <input type="number" id="carate350" name="number" placeholder="350" onchange="carate()">
      <input type="number" id="total1" name="number" placeholder="गेलेले कॅरेट रक्कम">
    </div>

    <div>
      <input type="number" id="bill1" name="number" placeholder="बिल रक्कम" onchange="totalBalance()">
      <input type="number" id="previousBalance" name="number" placeholder="मागील बाकी " readonly>
      <input type="number" id="totalBill" name="number" placeholder="एकूण रक्कम " >
    </div>

    <div>
      <input type="number" id="bill_cash" name="number" placeholder="रोख जमा" onchange="totalBalance()">
      <label for="message" aria-placeholder="OnlineAccount"></label>
      <select type="root" id="onlineAcc" name="onlineAcc">
      </select>
      <input type="number" id="online" name="number" placeholder="ऑनलाईन जमा " onchange="totalBalance()">
      <input type="number" id="discount" name="number" placeholder=" सूट रक्कम" onchange="totalBalance()">
    </div>

    <div>
      &nbsp;  &nbsp; &nbsp; जमा कॅरेट
      <input type="number" id="carate1100" name="number" placeholder="100" onchange="carate1()">
      <input type="number" id="carate1150" name="number" placeholder="150" onchange="carate1()">
      <input type="number" id="carate1250" name="number" placeholder="250" onchange="carate1()">
      <input type="number" id="carate1350" name="number" placeholder="350" onchange="carate1()">
      <input type="number" id="total2" name="number" placeholder="जमा कॅरेट रक्कम">
    </div>


    <div>
      <input type="text" id="note" name="name" placeholder="संदर्भ">
      <input type="number" id="baki" name="name" placeholder="बाकी रक्कम">
    </div>


    <button type="submit" class="save">Save</button>
    <button class="back">Back</button>
  </div>
  </form>

</body>
<script src="./sale.js"></script>
<script src="./sale2.js"></script>
<script>



 function totalBalance(){
  var balance = parseInt(document.getElementById("bill1").value) || 0;
  var preBalance = parseInt(document.getElementById("previousBalance").value) || 0;
  var total1 = parseInt(document.getElementById("total1").value) || 0;
  document.getElementById("totalBill").value = total1 + balance + preBalance;
  totalbill()

 } 

function previousbalance(){
  const name = document.getElementById("grahk").value
  fetch('http://43.205.230.120/fetchpv/' + name)
  .then(response => {
      if (!response.ok) {
          throw new Error('Network response was not ok');
      }
      return response.json();
  })
  .then(data => {
      // Populate dropdown with API data
      console.log(data)
      document.getElementById('previousBalance').value = parseInt(data[0]['current_balance'] || 0);
      totalBalance();
      totalbill();

  })
  .catch(error => {
      console.error('Error:', error);
  });

}


function carate(){
  var value100 = parseInt(document.getElementById("carate100").value) || 0;
  var value150 = parseInt(document.getElementById("carate150").value) || 0;
  var value250 = parseInt(document.getElementById("carate250").value) || 0;
  var value350 = parseInt(document.getElementById("carate350").value) || 0;
  document.getElementById("total1").value = value100 * 100 + value150 * 150 + value250 * 250 + value350 * 350;
  totalbill();
  totalBalance();
  //document.getElementById("total1").value = parseInt(document.getElementById("carate100").value) * 100 +  parseInt(document.getElementById("carate150").value) * 150 +  parseInt(document.getElementById("carate250").value) * 250 +  parseInt(document.getElementById("carate350").value) * 350
}

function carate1(){
  var value100 = parseInt(document.getElementById("carate1100").value) || 0;
  var value150 = parseInt(document.getElementById("carate1150").value) || 0;
  var value250 = parseInt(document.getElementById("carate1250").value) || 0;
  var value350 = parseInt(document.getElementById("carate1350").value) || 0;
  document.getElementById("total2").value = value100 * 100 + value150 * 150 + value250 * 250 + value350 * 350;
  totalbill();
  //document.getElementById("total1").value = parseInt(document.getElementById("carate100").value) * 100 +  parseInt(document.getElementById("carate150").value) * 150 +  parseInt(document.getElementById("carate250").value) * 250 +  parseInt(document.getElementById("carate350").value) * 350
}


function totalbill(){
  document.getElementById("baki").value = parseInt(document.getElementById("totalBill").value || 0) - parseInt(document.getElementById("bill_cash").value || 0) - parseInt(document.getElementById("online").value || 0) - parseInt(document.getElementById("discount").value || 0) - parseInt(document.getElementById("total2").value || 0);
}


  function myFunction() {
    event.preventDefault();
  
    var formData = {
      bill_id: parseInt(document.getElementById('bill').value),
      bata: document.getElementById('bta').value,
      mark: document.getElementById('mark').value,
      product: document.getElementById('product').value,
      quantity: parseInt(document.getElementById('nag').value),
      rate: parseInt(document.getElementById('kimmat').value),
      price: parseInt(document.getElementById('total').value)
    };

    console.log(formData)

    fetch('http://43.205.230.120/saleproductData/insertsaleproduct', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify(formData)
    })
      .then(response => {
        if (!response.ok) {
          throw new Error('Network response was not ok');
        }
        return response.json();
      })
      .then(result => {
        console.log('Entry added successfully:', result);
        document.getElementById('bill1').value = parseInt(document.getElementById('bill1').value || 0) + parseInt(document.getElementById('total').value);
        totalBalance()
        updateTable(formData, result);
      })
      .catch(error => {
        console.error('Error:', error);
      });
    alert('Button clicked!');
    // Add your desired functionality here
  }

  function updateTable(entry, result) {
    var tableBody = document.getElementById('tableBody1');
    var newRow = document.createElement('tr');
    newRow.innerHTML = `
          <td>${entry.product}</td>
          <td>${entry.bata}</td>
          <td>${entry.mark}</td>
          <td>${entry.quantity}</td>
          <td>${entry.rate}</td>
          <td>${entry.price}</td>
          <td><button type="button" onclick="deleteUser(this, ${result.insertId}, ${entry.price})">Delete</button></td>
      `;
    tableBody.appendChild(newRow);
  }

    function deleteUser(button,userId,price) {
      // Perform delete operation based on userId
      console.log(price)
      document.getElementById('bill1').value = parseInt(document.getElementById('bill1').value || 0) - price;
      totalBalance()
      var button = event.target;
      var row = button.parentNode.parentNode;
      fetch('http://43.205.230.120/saleproductData/deletesaleproduct/' + userId, {
        method: 'DELETE'
      })
        .then(response => {
          if (!response.ok) {
            throw new Error('Network response was not ok');
          }
          console.log('User deleted successfully');
          // Refresh the table or update UI as needed
          //newRow.remove();
          row.remove();
        })
        .catch(error => {
          console.error('Error:', error);
        });
    }
</script>

</html>
