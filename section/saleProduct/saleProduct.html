<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #fef7f7;
            margin: 0;
            padding:20px;
            overflow-x: hidden;
        }
        
        .container {
            /* margin: 0 auto;
            max-width: 800px;
            padding: 20px; */
            text-align: center;
            margin-bottom: 20px;
        }
        
        h1 {
            text-align: center;
            margin-bottom: 20px;
        }
        
        .button-container {
            text-align: center;
            margin-bottom: 20px;
        }
        
        .button {
            padding: 12px 24px;
            text-decoration: none;
            color: white;
            background-color: #808080;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
            margin: 0 10px;
        }
        
        .button:hover {
            background-color: #555;
        }
        
        .button a {
            color: white;
            text-decoration: none;
        }
        
        .table-container {
            max-width: 100%;
            overflow-x: auto; /* Enable horizontal scrolling */
            margin: 0 auto;
            max-height: calc(100vh - 200px); /* Adjust the height as needed */
            overflow-y: auto; /* Enable vertical scrolling */
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            background-color: #c7d5d3;
            box-shadow: 0px 2px 5px rgba(0, 0, 0, 0.1);
            border-radius: 5px;
        }
        
        th,
    td {
        border: 1px solid #dddddd;
        background-color: #eafffb;
        text-align: left;
        padding: 12px;
    }
        
        th {
            background-color: #c7d5d3;
        }
        /* Style the loader container */
#loader {
    border: 4px solid #f3f3f3; /* Light grey */
    border-top: 4px solid #3498db; /* Blue */
    border-radius: 50%;
    width: 30px;
    height: 30px;
    animation: spin 1s linear infinite; /* Apply animation */
    display: none; /* Hide loader by default */
    
    /* Center the loader */
    position: absolute;
    top: 60%;
    left: 50%;
    transform: translate(-50%, -50%);
  }
  
  /* Animation */
  @keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
  }
  
    </style>

</head>
<body>
    <div id="loader"></div>
    <div class="container">
        <h1>Sale - Product Data Bill Not Found</h1>
        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th>NO.</th>
                        <th>Bill No</th>
                        <th>प्रॉडक्ट</th>
                        <th>बटा</th>
                        <th>मार्क</th>
                        <th>नग</th>
                        <th>किंमत</th>
                        <th>रक्कम</th>
                        
                    </tr>
                </thead>
                <tbody id="tableBody">
                    <!-- Data will be inserted here -->
                </tbody>
            </table>
        </div>
    </div>

    <script>
        // Retrieve session data from localStorage
// var sessionData = JSON.parse(localStorage.getItem('sessionData'));

// // Check if session data exists and if the user is an admin
// var isAdmin = sessionData && sessionData[0].usertype === 'Admin';

// // Select the "Set User Menu" button element
// var setUserMenuButton = document.querySelector('.button-container button:nth-child(2)');

// // Check if the user is an admin and show/hide the button accordingly
// if (!isAdmin) {
//     setUserMenuButton.style.display = 'none'; // Hide the button for non-admin users
// }


function product() {
    console.log("product function executed");
    var loader = document.getElementById('loader');
    loader.style.display = 'block';
    fetch('http://103.174.102.89:3000/fetchData/noBillData')
    .then(response => {
        if (response.status === 404) {
            loader.style.display = 'none';
            Swal.fire({
                icon: 'error',
                title: 'Oops...',
                text: 'No data found.',
              });
            throw new Error('Data not found');
        }
        if (!response.ok) {
            throw new Error('Network response was not ok');
        }
        return response.json();
    })
        .then(data => {
            loader.style.display = 'none';
            console.log(data);
            populateTable(data);
        })
        .catch(error => {
            console.error('Error:', error);
        });
}




function populateTable(data) {
    var tbody = document.getElementById('tableBody');
    tbody.innerHTML = ''; // Clear existing rows
    var columnsToDisplay = ['bill_id','product','bata','mark','quantity', 'rate','price'];
    var counter = 1;
    var isAdmin = JSON.parse(localStorage.getItem('sessionData'))[0].usertype === 'Admin';
    var isSuperAdmin = JSON.parse(localStorage.getItem('sessionData'))[0].status === 'Super';
    data.forEach(function(item) {
        var row = tbody.insertRow();
        var cell = row.insertCell();
        cell.textContent = counter++;
        columnsToDisplay.forEach(function(key) {
            var cell = row.insertCell();
            cell.textContent = item[key];
        });

        // Add Delete button if user is admin
        if (isSuperAdmin) {
            var deleteCell = row.insertCell();
            var deleteButton = document.createElement('button');
            deleteButton.className = 'button delete-button';
            deleteButton.style.backgroundColor = '#ff355f';
            deleteButton.textContent = 'Delete';
            deleteButton.addEventListener('click', function() {
                // SweetAlert2 confirmation dialog
                Swal.fire({
                    title: 'Are you sure?',
                    text: "Do you really want to delete this user?",
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonColor: '#3085d6',
                    cancelButtonColor: '#d33',
                    confirmButtonText: 'Yes, delete it!'
                }).then((result) => {
                    if (result.isConfirmed) {
                        // Call the deleteUser function only if confirmed
                        deleteProduct(item.id); // Pass the user id to the delete function
        
                        // Optional: Show success message
                        Swal.fire(
                            'Deleted!',
                            'The Product has been deleted.',
                            'success'
                        );
                        product();
                    }
                });
            });
            deleteCell.appendChild(deleteButton);
        }
    });
}


function deleteProduct(userId) {
    // Perform delete operation based on userId
    fetch('http://103.174.102.89:3000/saleproductData/deletesaleproduct/' + userId, {
        method: 'DELETE'
    })
        .then(response => {
            if (!response.ok) {
                throw new Error('Network response was not ok');
            }
            console.log('User deleted successfully');

            Swal.fire({
                icon: 'success',
                title: 'Success!',
                text: 'Sale Data is successfully Deleted',
            })
            // Refresh the table or update UI as needed
            user(); // Assuming you want to refresh the table after delete
        })
        .catch(error => {
            console.error('Error:', error);
        });
}

product();



    </script>
</body>
</html>
